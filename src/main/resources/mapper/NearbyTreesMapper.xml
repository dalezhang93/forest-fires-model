<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

    <mapper namespace="com.example.forestfires.dao.mapper.NearbyTreesMapper">
      <insert id="batchInsertNearbyTrees">
        insert into nearbytrees(treeid,nearbytreeid,distance,angle,slope) values
        (#{tree.treeid}, #{tree.nearbytreeid},#{tree.distince}, #{tree.angle}, #{tree.slope})
      </insert>

      <delete id="cleanNearbyTreesTable">
        delete from nearbytrees
      </delete>

      <update id="resetNearbyTreesStatus">
        update nearbytrees set nearbytree_status = 0
        where nearbytree_status != 0
      </update>

      <update id="updateNearbyTreeStatus">
          update nearbytrees set nearbytree_status = #{status} where nearbytreeid=#{nearbytreeid}
      </update>

      <select id="possibleFireTrees" resultType="com.example.forestfires.domain.po.NearByTreesPO">
        select n.treeid, n.nearbytreeid, n.distance, n.angle, n.slope, n.nearbytree_status, date_format(start_fire_time, '%Y%m%d %H:%i') as nearyby_start_fire_time
        from trees t inner join nearbytrees n
            on t.treeid = n.treeid
            where t.status = 0 and nearbytree_status = 1
      </select>

    </mapper>
